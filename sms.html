<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‚¤ì˜¤ìŠ¤í¬ - ì•Œë¦¼í†¡ ëŒ€ê¸°í‘œ (ë°œì†¡ ì„¤ì • í¬í•¨)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 30px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .main-btn {
            background: #00b894;
            color: white;
            border: none;
            padding: 40px 60px;
            border-radius: 20px;
            font-size: 2rem;
            cursor: pointer;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,184,148,0.3);
        }
        
        .main-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0,184,148,0.4);
        }
        
        .main-btn:active {
            background: #00a085;
            transform: translateY(0);
        }

        /* ê´€ë¦¬ì ë²„íŠ¼ */
        .admin-access {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .admin-access:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        /* ì„¤ì • ìƒíƒœ í‘œì‹œ */
        .settings-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            min-width: 200px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .status-item:last-child {
            margin-bottom: 0;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e74c3c;
        }
        
        .status-indicator.active {
            background: #00b894;
        }

        /* íŒì—… */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .popup.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .popup-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .popup h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #333;
        }
        
        .phone-display {
            font-size: 2rem;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: monospace;
        }
        
        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .num-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 20px;
            font-size: 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            min-height: 60px;
            transition: all 0.3s ease;
        }
        
        .num-btn:hover {
            background: #2980b9;
            transform: scale(1.05);
        }
        
        .num-btn:active {
            background: #2980b9;
            transform: scale(0.95);
        }
        
        .delete-btn {
            background: #e74c3c;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        .clear-btn {
            background: #f39c12;
            font-size: 1rem;
        }
        
        .clear-btn:hover {
            background: #e67e22;
        }
        
        .close-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #7f8c8d;
        }
        
        .course-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .course-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 30px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102,126,234,0.3);
        }
        
        .course-btn:hover {
            background: #5a6fd8;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.4);
        }
        
        .course-btn:active {
            transform: translateY(0);
        }
        
        .success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #00b894;
            color: white;
            padding: 40px;
            border-radius: 20px;
            font-size: 1.5rem;
            z-index: 2000;
            display: none;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,184,148,0.3);
        }
        
        .success.show {
            display: block;
            animation: successShow 0.5s ease-out;
        }
        
        @keyframes successShow {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* ê´€ë¦¬ì ì„¤ì • ëª¨ë‹¬ */
        .admin-modal {
            display: none;
            position: fixed;
            z-index: 3000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        
        .admin-content {
            background-color: white;
            margin: 3% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f2f6;
        }
        
        .admin-header h2 {
            color: #667eea;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .close-admin {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-admin:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .setting-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
        }
        
        .setting-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2d3436;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .setting-row:last-child {
            margin-bottom: 0;
        }
        
        .setting-label {
            font-weight: 600;
            color: #2d3436;
            flex: 1;
        }
        
        .setting-input {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 200px;
            transition: all 0.3s ease;
        }
        
        .setting-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .setting-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .setting-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #00b894;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .save-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 5px 20px rgba(0,184,148,0.3);
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,184,148,0.4);
        }
        
        .test-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }
        
        .test-btn:hover {
            background: #e67e22;
            transform: scale(1.05);
        }
        
        .test-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        /* ì„¤ì • ìƒíƒœ í‘œì‹œ */
        .config-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .config-status.enabled {
            background: #d4edda;
            color: #155724;
        }
        
        .config-status.disabled {
            background: #f8d7da;
            color: #721c24;
        }

        /* í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
        .template-preview {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .template-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .template-item h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .template-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Malgun Gothic', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            color: #2d3436;
            border: 1px solid #e9ecef;
        }
        
        /* í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìŠ¤íƒ€ì¼ */
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            display: none;
        }
        
        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-result.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .admin-content {
                margin: 1% auto;
                padding: 20px;
            }
            
            .setting-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .setting-input {
                width: 100%;
                min-width: auto;
            }
            
            .course-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .main-btn {
                padding: 30px 40px;
                font-size: 1.8rem;
            }
        }
    </style>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCNhcSqZgtSS63QTmjWtiMxgy5g8soOzho",
            authDomain: "alimtalk-waiting-ticket.firebaseapp.com",
            databaseURL: "https://alimtalk-waiting-ticket-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "alimtalk-waiting-ticket",
            storageBucket: "alimtalk-waiting-ticket.firebasestorage.app",
            messagingSenderId: "313045604729",
            appId: "1:313045604729:web:2599fe60cad2b573bc37a8"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseOnValue = onValue;
    </script>
</head>
<body>
    <!-- ê´€ë¦¬ì ë²„íŠ¼ -->
    <button class="admin-access" onclick="showAdminModal()">âš™ï¸ ê´€ë¦¬ì ì„¤ì •</button>

    <!-- ì„¤ì • ìƒíƒœ í‘œì‹œ -->
    <div class="settings-status" id="settingsStatus">
        <div class="status-item">
            <span>ì•Œë¦¼í†¡ ë°œì†¡</span>
            <span class="status-indicator" id="smsStatus"></span>
        </div>
        <div class="status-item">
            <span>Firebase ì—°ê²°</span>
            <span class="status-indicator" id="firebaseStatus"></span>
        </div>
        <div class="status-item">
            <span>ìë™ ë°œì†¡</span>
            <span class="status-indicator" id="autoStatus"></span>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ“± ì•Œë¦¼í†¡ ëŒ€ê¸°í‘œ</h1>
        </div>
        
        <button class="main-btn" onclick="showPhonePopup()">
            ëŒ€ê¸°í‘œ ë°œê¸‰í•˜ê¸°
        </button>
    </div>

    <!-- í•¸ë“œí° ë²ˆí˜¸ íŒì—… -->
    <div class="popup" id="phonePopup">
        <div class="popup-content">
            <h2>í•¸ë“œí° ë²ˆí˜¸ ì…ë ¥</h2>
            <div class="phone-display" id="phoneDisplay">010-</div>
            
            <div class="number-pad">
                <button class="num-btn" onclick="addNum('1')">1</button>
                <button class="num-btn" onclick="addNum('2')">2</button>
                <button class="num-btn" onclick="addNum('3')">3</button>
                <button class="num-btn" onclick="addNum('4')">4</button>
                <button class="num-btn" onclick="addNum('5')">5</button>
                <button class="num-btn" onclick="addNum('6')">6</button>
                <button class="num-btn" onclick="addNum('7')">7</button>
                <button class="num-btn" onclick="addNum('8')">8</button>
                <button class="num-btn" onclick="addNum('9')">9</button>
                <button class="num-btn delete-btn" onclick="deleteNum()">â†</button>
                <button class="num-btn" onclick="addNum('0')">0</button>
                <button class="num-btn clear-btn" onclick="clearNum()">ì „ì²´ì‚­ì œ</button>
            </div>
            
            <button class="close-btn" onclick="closePhonePopup()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- ê³¼ì • ì„ íƒ íŒì—… -->
    <div class="popup" id="coursePopup">
        <div class="popup-content">
            <h2>ê³¼ì • ì„ íƒ</h2>
            <div class="phone-display" id="selectedPhone">010-1234-5678</div>
            
            <div class="course-grid" id="courseGrid">
                <!-- ê³¼ì • ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            
            <button class="close-btn" onclick="closeCoursePopup()">ëŒì•„ê°€ê¸°</button>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ì„¤ì • ëª¨ë‹¬ -->
    <div id="adminModal" class="admin-modal">
        <div class="admin-content">
            <div class="admin-header">
                <h2>âš™ï¸ ì•Œë¦¼í†¡ ë°œì†¡ ì„¤ì •</h2>
                <button class="close-admin" onclick="hideAdminModal()">Ã—</button>
            </div>
            
            <!-- ì†”ë¼í”¼ ì•Œë¦¼í†¡ ì„¤ì • -->
            <div class="setting-section">
                <div class="setting-title">ğŸ“± ì†”ë¼í”¼ ì•Œë¦¼í†¡ ì„¤ì •</div>
                
                <div class="setting-row">
                    <label class="setting-label">ì†”ë¼í”¼ API í‚¤</label>
                    <input type="text" class="setting-input" id="solapiApiKey" placeholder="NCSRVLD2FFGTEK7B">
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ì†”ë¼í”¼ ì‹œí¬ë¦¿ í‚¤</label>
                    <input type="password" class="setting-input" id="solapiSecret" placeholder="ì‹œí¬ë¦¿ í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ë°œì‹ ë²ˆí˜¸ (ë“±ë¡ëœ ë²ˆí˜¸)</label>
                    <input type="text" class="setting-input" id="senderNumber" placeholder="02-1234-5678">
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ì¹´ì¹´ì˜¤ ì±„ë„ ID</label>
                    <input type="text" class="setting-input" id="kakaoChannelId" placeholder="@your_channel">
                </div>
            </div>
            
            <!-- ì•Œë¦¼í†¡ í…œí”Œë¦¿ ì„¤ì • -->
            <div class="setting-section">
                <div class="setting-title">ğŸ“‹ ì•Œë¦¼í†¡ í…œí”Œë¦¿ ì„¤ì •</div>
                
                <div class="setting-row">
                    <label class="setting-label">ë°œê¸‰ì™„ë£Œ í…œí”Œë¦¿ ì½”ë“œ</label>
                    <input type="text" class="setting-input" id="templateIssue" placeholder="ISSUE_TEMPLATE_001">
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ê³§ í˜¸ì¶œì˜ˆì • í…œí”Œë¦¿ ì½”ë“œ</label>
                    <input type="text" class="setting-input" id="templateReady" placeholder="READY_TEMPLATE_001">
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">í˜¸ì¶œì•Œë¦¼ í…œí”Œë¦¿ ì½”ë“œ</label>
                    <input type="text" class="setting-input" id="templateCall" placeholder="CALL_TEMPLATE_001">
                </div>
            </div>
            
            <!-- ë©”ì‹œì§€ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° -->
            <div class="setting-section">
                <div class="setting-title">ğŸ’¬ ë©”ì‹œì§€ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°</div>
                
                <div class="template-preview">
                    <div class="template-item">
                        <h4>ğŸ“ ë°œê¸‰ì™„ë£Œ ì•Œë¦¼</h4>
                        <div class="template-content">
                            [ìˆœë²ˆëŒ€ê¸°í‘œ ë°œê¸‰ì™„ë£Œ]<br>
                            ëŒ€ê¸°ë²ˆí˜¸: #ticketNumber<br>
                            ê³¼ì •: #courseName<br>
                            ë°œê¸‰ì‹œê°„: #issueTime<br>
                            í˜„ì¬ ëŒ€ê¸°: #waitingCountëª…<br>
                            ì˜ˆìƒ ëŒ€ê¸°ì‹œê°„: ì•½ #estimatedTimeë¶„<br>
                            í˜¸ì¶œ ì‹œ ë‹¤ì‹œ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.
                        </div>
                    </div>
                    
                    <div class="template-item">
                        <h4>â° ê³§ í˜¸ì¶œì˜ˆì • ì•Œë¦¼</h4>
                        <div class="template-content">
                            [ê³§ í˜¸ì¶œì˜ˆì •]<br>
                            ëŒ€ê¸°ë²ˆí˜¸: #ticketNumber<br>
                            ê³¼ì •: #courseName<br>
                            ì•ìœ¼ë¡œ #waitingCountëª… ë‚¨ì•˜ìŠµë‹ˆë‹¤.<br>
                            ì¤€ë¹„í•´ì£¼ì„¸ìš”!
                        </div>
                    </div>
                    
                    <div class="template-item">
                        <h4>ğŸ“¢ í˜¸ì¶œì•Œë¦¼</h4>
                        <div class="template-content">
                            [í˜¸ì¶œì•Œë¦¼]<br>
                            ëŒ€ê¸°ë²ˆí˜¸: #ticketNumber<br>
                            #counterNumberë²ˆ ì°½êµ¬ë¡œ ì™€ì£¼ì„¸ìš”!<br>
                            ê³¼ì •: #courseName<br>
                            í˜¸ì¶œì‹œê°„: #callTime
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ì•Œë¦¼ ì„¤ì • -->
            <div class="setting-section">
                <div class="setting-title">ğŸ”” ì•Œë¦¼ ì„¤ì •</div>
                
                <div class="setting-row">
                    <label class="setting-label">ë°œê¸‰ì™„ë£Œ ì•Œë¦¼ (í•„ìˆ˜)</label>
                    <label class="setting-toggle">
                        <input type="checkbox" id="notificationIssue" checked disabled>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ê³§ í˜¸ì¶œì˜ˆì • ì•Œë¦¼ (ì„ íƒ)</label>
                    <label class="setting-toggle">
                        <input type="checkbox" id="notificationReady">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">í˜¸ì¶œì•Œë¦¼ (ìë™ - ì°½êµ¬ì‹œìŠ¤í…œ)</label>
                    <label class="setting-toggle">
                        <input type="checkbox" id="notificationCall" checked disabled>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ìë™ ë°œì†¡ í™œì„±í™”</label>
                    <label class="setting-toggle">
                        <input type="checkbox" id="autoSend">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">í…ŒìŠ¤íŠ¸ ëª¨ë“œ</label>
                    <label class="setting-toggle">
                        <input type="checkbox" id="testMode">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ë°œì†¡ ë¡œê·¸ ì €ì¥</label>
                    <label class="setting-toggle">
                        <input type="checkbox" id="saveLog">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <!-- ì†”ë¼í”¼ ì—°ê²° ì§„ë‹¨ -->
            <div class="setting-section">
                <div class="setting-title">ğŸ” ì†”ë¼í”¼ ì—°ê²° ì§„ë‹¨</div>
                
                <div class="setting-row">
                    <label class="setting-label">ì—°ê²° ìƒíƒœ í™•ì¸</label>
                    <div>
                        <button class="test-btn" onclick="checkSolapiConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
                        <button class="test-btn" onclick="checkSolapiProfile()">ê³„ì • ì •ë³´</button>
                    </div>
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ë°œì‹ ë²ˆí˜¸ ëª©ë¡ í™•ì¸</label>
                    <div>
                        <button class="test-btn" onclick="checkSenderNumbers()">ë°œì‹ ë²ˆí˜¸ ì¡°íšŒ</button>
                        <button class="test-btn" onclick="checkTemplates()">í…œí”Œë¦¿ ì¡°íšŒ</button>
                    </div>
                </div>
                
                <div class="test-result" id="diagnosticResult"></div>
            </div>
            <!-- í…ŒìŠ¤íŠ¸ ë° ì €ì¥ -->
            <div class="setting-section">
                <div class="setting-title">ğŸ”§ í…ŒìŠ¤íŠ¸ ë° ì €ì¥</div>
                
                <div class="setting-row">
                    <label class="setting-label">í…ŒìŠ¤íŠ¸ ë°œì†¡ (ë³¸ì¸ ë²ˆí˜¸)</label>
                    <div>
                        <input type="text" class="setting-input" id="testNumber" placeholder="01012345678" style="width: 200px;">
                        <button class="test-btn" onclick="sendTestMessage()">í…ŒìŠ¤íŠ¸ ë°œì†¡</button>
                    </div>
                </div>
                
                <div class="test-result" id="testResult"></div>
            </div>
            
            <button class="save-btn" onclick="saveSettings()">ì„¤ì • ì €ì¥</button>
        </div>
    </div>

    <!-- ì„±ê³µ ë©”ì‹œì§€ -->
    <div class="success" id="successMsg">
        <div id="successText">ëŒ€ê¸°í‘œ ë°œê¸‰ ì™„ë£Œ!</div>
    </div>

    <script>
        let phoneNumber = '';
        let currentNumbers = { CH: 0, EN: 0, HSK: 0, TO: 0 };
        let courses = [
            { code: 'CH', name: 'ì¤‘êµ­ì–´ ê³¼ì •' },
            { code: 'EN', name: 'ì˜ì–´ ê³¼ì •' },
            { code: 'HSK', name: 'HSK ì‹œí—˜ë°˜' },
            { code: 'TO', name: 'TOEIC ì§‘ì¤‘ë°˜' }
        ];

        // ì†”ë¼í”¼ ì•Œë¦¼í†¡ ì„¤ì • (ê¸°ë³¸ê°’)
        let smsSettings = {
            // ì†”ë¼í”¼ API ì„¤ì •
            solapiApiKey: 'NCSRVLD2FFGTEK7B',
            solapiSecret: 'IYLPMGODFSDJA3Y88QZDHBQYG6XYCNV8',
            senderNumber: '',
            kakaoChannelId: '',
            
            // ì•Œë¦¼í†¡ í…œí”Œë¦¿ ì½”ë“œë“¤
            templates: {
                issue: '',      // ë°œê¸‰ì™„ë£Œ í…œí”Œë¦¿
                ready: '',      // ê³§ í˜¸ì¶œì˜ˆì • í…œí”Œë¦¿  
                call: ''        // í˜¸ì¶œì•Œë¦¼ í…œí”Œë¦¿
            },
            
            // ë©”ì‹œì§€ í…œí”Œë¦¿ë“¤
            messageTemplates: {
                issue: '[ìˆœë²ˆëŒ€ê¸°í‘œ ë°œê¸‰ì™„ë£Œ]\nëŒ€ê¸°ë²ˆí˜¸: #ticketNumber\nê³¼ì •: #courseName\në°œê¸‰ì‹œê°„: #issueTime\ní˜„ì¬ ëŒ€ê¸°: #waitingCountëª…\nì˜ˆìƒ ëŒ€ê¸°ì‹œê°„: ì•½ #estimatedTimeë¶„\ní˜¸ì¶œ ì‹œ ë‹¤ì‹œ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.',
                ready: '[ê³§ í˜¸ì¶œì˜ˆì •]\nëŒ€ê¸°ë²ˆí˜¸: #ticketNumber\nê³¼ì •: #courseName\nì•ìœ¼ë¡œ #waitingCountëª… ë‚¨ì•˜ìŠµë‹ˆë‹¤.\nì¤€ë¹„í•´ì£¼ì„¸ìš”!',
                call: '[í˜¸ì¶œì•Œë¦¼]\nëŒ€ê¸°ë²ˆí˜¸: #ticketNumber\n#counterNumberë²ˆ ì°½êµ¬ë¡œ ì™€ì£¼ì„¸ìš”!\nê³¼ì •: #courseName\ní˜¸ì¶œì‹œê°„: #callTime'
            },
            
            // ë°œì†¡ ì˜µì…˜
            autoSend: false,
            testMode: false,
            saveLog: true,
            
            // ì•Œë¦¼ íƒ€ì…ë³„ í™œì„±í™”
            notifications: {
                issue: true,    // ë°œê¸‰ì™„ë£Œ ì•Œë¦¼
                ready: false,   // ê³§ í˜¸ì¶œì˜ˆì • ì•Œë¦¼ (ì„ íƒì‚¬í•­)
                call: true      // í˜¸ì¶œì•Œë¦¼
            }
        };

        // ì´ˆê¸°í™”
        function initialize() {
            console.log('ğŸ« ì•Œë¦¼í†¡ í‚¤ì˜¤ìŠ¤í¬ ì´ˆê¸°í™” ì‹œì‘');
            
            // Firebaseì—ì„œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            loadSettings();
            
            // í‚¤ì˜¤ìŠ¤í¬ ê¸€ë¡œë²Œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            loadGlobalSettings();
            
            // ê³¼ì • ë²„íŠ¼ ìƒì„±
            renderCourseButtons();
            
            // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateStatusDisplay();
            
            console.log('âœ… ì•Œë¦¼í†¡ í‚¤ì˜¤ìŠ¤í¬ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // Firebaseì—ì„œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSettings() {
            if (!window.firebaseDB) return;
            
            const settingsRef = window.firebaseRef(window.firebaseDB, 'kioskSettings');
            window.firebaseOnValue(settingsRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    smsSettings = { ...smsSettings, ...data };
                    console.log('ğŸ“¥ ì•Œë¦¼í†¡ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ:', smsSettings);
                    updateStatusDisplay();
                }
            });
        }

        // í‚¤ì˜¤ìŠ¤í¬ ê¸€ë¡œë²Œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        function loadGlobalSettings() {
            if (!window.firebaseDB) return;
            
            const globalRef = window.firebaseRef(window.firebaseDB, 'kioskGlobalSettings');
            window.firebaseOnValue(globalRef, (snapshot) => {
                const data = snapshot.val();
                if (data && data.courses) {
                    courses = data.courses;
                    console.log('ğŸ“š ê³¼ì • ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ:', courses);
                    renderCourseButtons();
                }
            });
        }

        // ê³¼ì • ë²„íŠ¼ ë™ì  ìƒì„±
        function renderCourseButtons() {
            const courseGrid = document.getElementById('courseGrid');
            courseGrid.innerHTML = '';
            
            courses.forEach(course => {
                const button = document.createElement('button');
                button.className = 'course-btn';
                button.textContent = course.name;
                button.onclick = () => selectCourse(course);
                courseGrid.appendChild(button);
            });
        }

        // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateStatusDisplay() {
            const smsStatus = document.getElementById('smsStatus');
            const firebaseStatus = document.getElementById('firebaseStatus');
            const autoStatus = document.getElementById('autoStatus');
            
            // ì†”ë¼í”¼ ì„¤ì • ìƒíƒœ í™•ì¸
            if (smsSettings.solapiApiKey && smsSettings.solapiSecret && smsSettings.senderNumber) {
                smsStatus.classList.add('active');
            } else {
                smsStatus.classList.remove('active');
            }
            
            // Firebase ì—°ê²° ìƒíƒœ
            if (window.firebaseDB) {
                firebaseStatus.classList.add('active');
            } else {
                firebaseStatus.classList.remove('active');
            }
            
            // ìë™ ë°œì†¡ ìƒíƒœ
            if (smsSettings.autoSend) {
                autoStatus.classList.add('active');
            } else {
                autoStatus.classList.remove('active');
            }
        }

        // íŒì—… ì—´ê¸°
        function showPhonePopup() {
            phoneNumber = '';
            updatePhoneDisplay();
            document.getElementById('phonePopup').classList.add('show');
        }

        // íŒì—… ë‹«ê¸°
        function closePhonePopup() {
            document.getElementById('phonePopup').classList.remove('show');
        }

        function closeCoursePopup() {
            document.getElementById('coursePopup').classList.remove('show');
        }

        // ë²ˆí˜¸ ì¶”ê°€
        function addNum(num) {
            console.log('ë²ˆí˜¸ ì¶”ê°€:', num);
            if (phoneNumber.length < 11) {
                phoneNumber += num;
                updatePhoneDisplay();
                
                if (phoneNumber.length === 11) {
                    setTimeout(() => {
                        closePhonePopup();
                        showCoursePopup();
                    }, 300);
                }
            }
        }

        // ë²ˆí˜¸ ì‚­ì œ
        function deleteNum() {
            console.log('ë²ˆí˜¸ ì‚­ì œ');
            if (phoneNumber.length > 0) {
                phoneNumber = phoneNumber.slice(0, -1);
                updatePhoneDisplay();
            }
        }

        // ì „ì²´ ì‚­ì œ
        function clearNum() {
            console.log('ì „ì²´ ì‚­ì œ');
            phoneNumber = '';
            updatePhoneDisplay();
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updatePhoneDisplay() {
            const display = document.getElementById('phoneDisplay');
            
            if (phoneNumber.length === 0) {
                display.textContent = '010-';
            } else if (phoneNumber.length <= 4) {
                display.textContent = '010-' + phoneNumber;
            } else if (phoneNumber.length <= 8) {
                display.textContent = '010-' + phoneNumber.substring(0, 4) + '-' + phoneNumber.substring(4);
            } else {
                display.textContent = '010-' + phoneNumber.substring(0, 4) + '-' + phoneNumber.substring(4, 8);
            }
        }

        // ê³¼ì • ì„ íƒ íŒì—…
        function showCoursePopup() {
            const formatted = '010-' + phoneNumber.substring(0, 4) + '-' + phoneNumber.substring(4);
            document.getElementById('selectedPhone').textContent = formatted;
            document.getElementById('coursePopup').classList.add('show');
        }

        // ê³¼ì • ì„ íƒ
        function selectCourse(course) {
            console.log('ê³¼ì • ì„ íƒ:', course.name);
            
            // ë²ˆí˜¸ ìƒì„±
            currentNumbers[course.code]++;
            const ticketNumber = course.code + currentNumbers[course.code].toString().padStart(3, '0');
            
            // í˜„ì¬ ëŒ€ê¸° ì¸ì› ìˆ˜ ê³„ì‚°
            getCurrentWaitingCount().then(waitingCount => {
                // ëŒ€ê¸°í‘œ ë°ì´í„° ìƒì„±
                const ticketData = {
                    number: ticketNumber,
                    course: course.name,
                    phoneNumber: '010' + phoneNumber,
                    time: new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
                    timestamp: new Date().toISOString(),
                    waitingCount: waitingCount
                };
                
                // ëŒ€ê¸°ì—´ì— ì¶”ê°€
                addToWaitingQueue(ticketData);
                
                // ì•Œë¦¼í†¡ ë°œì†¡ (ë°œê¸‰ì™„ë£Œ)
                if (smsSettings.autoSend) {
                    sendSMS(ticketData, 'issue');
                }
                
                // ì„±ê³µ ë©”ì‹œì§€
                showSuccess(ticketNumber, course.name);
                closeCoursePopup();
            });
        }
        
        // í˜„ì¬ ëŒ€ê¸° ì¸ì› ìˆ˜ ê°€ì ¸ì˜¤ê¸°
        async function getCurrentWaitingCount() {
            if (!window.firebaseDB) return 0;
            
            try {
                const systemRef = window.firebaseRef(window.firebaseDB, 'counterSystem');
                const snapshot = await window.firebaseGet(systemRef);
                const systemData = snapshot.val();
                
                if (systemData && systemData.waiting) {
                    return systemData.waiting.length;
                }
                return 0;
            } catch (error) {
                console.error('ëŒ€ê¸° ì¸ì› ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', error);
                return 0;
            }
        }Settings.autoSend) {
                sendSMS(ticketData);
            }
            
            // ì„±ê³µ ë©”ì‹œì§€
            showSuccess(ticketNumber, course.name);
            closeCoursePopup();
        }

        // ëŒ€ê¸°ì—´ì— ì¶”ê°€
        function addToWaitingQueue(ticketData) {
            if (!window.firebaseDB) return;
            
            // ì¹´ìš´í„° ì‹œìŠ¤í…œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const systemRef = window.firebaseRef(window.firebaseDB, 'counterSystem');
            window.firebaseGet(systemRef).then((snapshot) => {
                let systemData = snapshot.val();
                
                if (!systemData) {
                    systemData = {
                        currentCall: { number: '-', counter: 0, course: '-' },
                        waiting: [],
                        counters: Array.from({length: 6}, (_, i) => ({
                            id: i + 1,
                            current: null,
                            course: null,
                            count: 0
                        })),
                        totalToday: 0,
                        counterSettings: {}
                    };
                }
                
                // ëŒ€ê¸°ì—´ì— ì¶”ê°€
                if (!systemData.waiting) systemData.waiting = [];
                systemData.waiting.push(ticketData);
                systemData.totalToday = (systemData.totalToday || 0) + 1;
                
                // Firebaseì— ì €ì¥
                window.firebaseSet(systemRef, systemData);
                
                console.log('âœ… ëŒ€ê¸°ì—´ ì¶”ê°€ ì™„ë£Œ:', ticketData);
            }).catch(error => {
                console.error('âŒ ëŒ€ê¸°ì—´ ì¶”ê°€ ì‹¤íŒ¨:', error);
            });
        }

        // ì†”ë¼í”¼ ì•Œë¦¼í†¡ ë°œì†¡ (ìˆ˜ì •ëœ ë²„ì „)
        async function sendSolapi(ticketData, notificationType = 'issue') {
            if (!smsSettings.solapiApiKey || !smsSettings.solapiSecret || !smsSettings.senderNumber) {
                console.log('âš ï¸ ì†”ë¼í”¼ ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return { success: false, error: 'Settings not configured' };
            }
            
            try {
                // ë©”ì‹œì§€ í…œí”Œë¦¿ ì„ íƒ
                const templateCode = smsSettings.templates[notificationType];
                const messageTemplate = smsSettings.messageTemplates[notificationType];
                
                if (!templateCode || !messageTemplate) {
                    throw new Error(`í…œí”Œë¦¿ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤: ${notificationType}`);
                }
                
                // ì˜ˆìƒ ëŒ€ê¸°ì‹œê°„ ê³„ì‚° (í‰ê·  5ë¶„ìœ¼ë¡œ ê°€ì •)
                const estimatedTime = Math.max(5, (ticketData.waitingCount || 0) * 5);
                
                // ë©”ì‹œì§€ ë‚´ìš© ìƒì„±
                const message = messageTemplate
                    .replace(/#ticketNumber/g, ticketData.number)
                    .replace(/#courseName/g, ticketData.course)
                    .replace(/#issueTime/g, ticketData.time)
                    .replace(/#waitingCount/g, ticketData.waitingCount || 0)
                    .replace(/#estimatedTime/g, estimatedTime)
                    .replace(/#counterNumber/g, ticketData.counterNumber || '')
                    .replace(/#callTime/g, ticketData.callTime || '');
                
                // í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì²˜ë¦¬
                if (smsSettings.testMode) {
                    console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ëª¨ë“œ - ì‹¤ì œ ë°œì†¡ ì—†ì´ ë¡œê·¸ë§Œ ê¸°ë¡');
                    console.log('ğŸ“‹ í…ŒìŠ¤íŠ¸ ë°ì´í„°:', {
                        type: notificationType,
                        to: ticketData.phoneNumber,
                        from: smsSettings.senderNumber,
                        message: message,
                        templateCode: templateCode
                    });
                    return { 
                        success: true, 
                        messageId: 'TEST_' + Date.now(),
                        testMode: true,
                        message: message
                    };
                }
                
                // ì†”ë¼í”¼ ì¸ì¦ í—¤ë” ìƒì„±
                const timestamp = new Date().toISOString();
                const salt = Math.random().toString(36).substring(2, 15);
                
                // ì†”ë¼í”¼ API ìš”ì²­ ë°ì´í„° (ê°„ë‹¨í•œ SMS ë°©ì‹ìœ¼ë¡œ ë¨¼ì € í…ŒìŠ¤íŠ¸)
                const solapiData = {
                    message: {
                        to: ticketData.phoneNumber,
                        from: smsSettings.senderNumber,
                        text: message
                    }
                };
                
                console.log('ğŸ“± ì†”ë¼í”¼ ë°œì†¡ ì‹œë„:', solapiData);
                
                // ì†”ë¼í”¼ API í˜¸ì¶œ (Basic Auth ë°©ì‹ìœ¼ë¡œ ë³€ê²½)
                const credentials = btoa(`${smsSettings.solapiApiKey}:${smsSettings.solapiSecret}`);
                
                const response = await fetch('https://api.solapi.com/messages/v4/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Basic ${credentials}`
                    },
                    body: JSON.stringify(solapiData)
                });
                
                const result = await response.json();
                
                console.log('ğŸ“¨ ì†”ë¼í”¼ ì‘ë‹µ:', result);
                
                if (response.ok) {
                    console.log('âœ… ì†”ë¼í”¼ ë°œì†¡ ì„±ê³µ:', result);
                    return { success: true, ...result };
                } else {
                    console.error('âŒ ì†”ë¼í”¼ ë°œì†¡ ì‹¤íŒ¨:', result);
                    return { 
                        success: false, 
                        error: result.errorMessage || result.message || 'Unknown error',
                        statusCode: response.status,
                        responseData: result
                    };
                }
                
            } catch (error) {
                console.error('âŒ ì†”ë¼í”¼ ë°œì†¡ ì˜¤ë¥˜:', error);
                return { success: false, error: error.message };
            }
        }
        
        // ì†”ë¼í”¼ ì—°ê²° ì§„ë‹¨ í•¨ìˆ˜ë“¤
        async function checkSolapiConnection() {
            const diagnosticResult = document.getElementById('diagnosticResult');
            showDiagnosticResult('ì†”ë¼í”¼ ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
            
            const result = await testSolapiConnection();
            
            if (result.success) {
                showDiagnosticResult('âœ… ì†”ë¼í”¼ ì—°ê²° ì„±ê³µ!', 'success');
            } else {
                showDiagnosticResult(`âŒ ì†”ë¼í”¼ ì—°ê²° ì‹¤íŒ¨: ${result.error}`, 'error');
            }
        }
        
        async function checkSolapiProfile() {
            showDiagnosticResult('ì†”ë¼í”¼ ê³„ì • ì •ë³´ ì¡°íšŒ ì¤‘...', 'info');
            
            const result = await testSolapiConnection();
            
            if (result.success && result.profile) {
                const profile = result.profile;
                showDiagnosticResult(
                    `âœ… ê³„ì • ì •ë³´:\nê³„ì • ID: ${profile.accountId || 'N/A'}\nì”ì•¡: ${profile.balance || 'N/A'}ì›\nìƒíƒœ: ${profile.status || 'N/A'}`,
                    'success'
                );
            } else {
                showDiagnosticResult(`âŒ ê³„ì • ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${result.error}`, 'error');
            }
        }
        
        async function checkSenderNumbers() {
            showDiagnosticResult('ë°œì‹ ë²ˆí˜¸ ëª©ë¡ ì¡°íšŒ ì¤‘...', 'info');
            
            if (!smsSettings.solapiApiKey || !smsSettings.solapiSecret) {
                showDiagnosticResult('âŒ API í‚¤ ë˜ëŠ” ì‹œí¬ë¦¿ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const credentials = btoa(`${smsSettings.solapiApiKey}:${smsSettings.solapiSecret}`);
                
                const response = await fetch('https://api.solapi.com/senders/v1/senders', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Basic ${credentials}`
                    }
                });
                
                const result = await response.json();
                
                if (response.ok && result.senders) {
                    const senders = result.senders;
                    if (senders.length > 0) {
                        const senderList = senders.map(sender => 
                            `${sender.senderId} (${sender.status})`
                        ).join('\n');
                        showDiagnosticResult(`âœ… ë“±ë¡ëœ ë°œì‹ ë²ˆí˜¸:\n${senderList}`, 'success');
                    } else {
                        showDiagnosticResult('âŒ ë“±ë¡ëœ ë°œì‹ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    }
                } else {
                    showDiagnosticResult(`âŒ ë°œì‹ ë²ˆí˜¸ ì¡°íšŒ ì‹¤íŒ¨: ${result.errorMessage || 'Unknown error'}`, 'error');
                }
                
            } catch (error) {
                showDiagnosticResult(`âŒ ë°œì‹ ë²ˆí˜¸ ì¡°íšŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        async function checkTemplates() {
            showDiagnosticResult('ì•Œë¦¼í†¡ í…œí”Œë¦¿ ì¡°íšŒ ì¤‘...', 'info');
            
            if (!smsSettings.solapiApiKey || !smsSettings.solapiSecret) {
                showDiagnosticResult('âŒ API í‚¤ ë˜ëŠ” ì‹œí¬ë¦¿ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const credentials = btoa(`${smsSettings.solapiApiKey}:${smsSettings.solapiSecret}`);
                
                const response = await fetch('https://api.solapi.com/kakao/v1/templates', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Basic ${credentials}`
                    }
                });
                
                const result = await response.json();
                
                if (response.ok && result.templates) {
                    const templates = result.templates;
                    if (templates.length > 0) {
                        const templateList = templates.map(template => 
                            `${template.templateId} (${template.status})`
                        ).join('\n');
                        showDiagnosticResult(`âœ… ë“±ë¡ëœ í…œí”Œë¦¿:\n${templateList}`, 'success');
                    } else {
                        showDiagnosticResult('âŒ ë“±ë¡ëœ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    }
                } else {
                    showDiagnosticResult(`âŒ í…œí”Œë¦¿ ì¡°íšŒ ì‹¤íŒ¨: ${result.errorMessage || 'Unknown error'}`, 'error');
                }
                
            } catch (error) {
                showDiagnosticResult(`âŒ í…œí”Œë¦¿ ì¡°íšŒ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }
        
        // ì§„ë‹¨ ê²°ê³¼ í‘œì‹œ
        function showDiagnosticResult(message, type) {
            const diagnosticResult = document.getElementById('diagnosticResult');
            diagnosticResult.innerHTML = message.replace(/\n/g, '<br>');
            diagnosticResult.className = `test-result ${type}`;
            diagnosticResult.style.display = 'block';
            
            // infoê°€ ì•„ë‹Œ ê²½ìš°ë§Œ ìë™ ìˆ¨ê¹€
            if (type !== 'info') {
                setTimeout(() => {
                    diagnosticResult.style.display = 'none';
                }, 10000);
            }
        } else {
                    console.error('âŒ ì†”ë¼í”¼ ì—°ê²° ì‹¤íŒ¨:', result);
                    return { success: false, error: result.errorMessage || result.message };
                }
                
            } catch (error) {
                console.error('âŒ ì†”ë¼í”¼ ì—°ê²° ì˜¤ë¥˜:', error);
                return { success: false, error: error.message };
            }
        }
        
        // í†µí•© ì•Œë¦¼í†¡ ë°œì†¡ í•¨ìˆ˜
        async function sendSMS(ticketData, notificationType = 'issue') {
            if (!smsSettings.notifications[notificationType]) {
                console.log(`ğŸ“µ ${notificationType} ì•Œë¦¼ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`);
                return;
            }
            
            const result = await sendSolapi(ticketData, notificationType);
            
            // ë¡œê·¸ ì €ì¥
            if (smsSettings.saveLog) {
                saveLog({
                    ...ticketData,
                    notificationType,
                    smsResult: result,
                    sendTime: new Date().toISOString(),
                    status: result.success ? 'success' : 'failed'
                });
            }
            
            return result;
        }

        // ë¡œê·¸ ì €ì¥
        function saveLog(logData) {
            if (!window.firebaseDB) return;
            
            const logRef = window.firebaseRef(window.firebaseDB, `smsLogs/${new Date().toISOString().split('T')[0]}`);
            const timestamp = new Date().toISOString();
            
            window.firebaseGet(logRef).then((snapshot) => {
                let logs = snapshot.val() || {};
                logs[timestamp] = logData;
                return window.firebaseSet(logRef, logs);
            }).then(() => {
                console.log('ğŸ“ ë¡œê·¸ ì €ì¥ ì™„ë£Œ');
            }).catch(error => {
                console.error('âŒ ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', error);
            });
        }

        // ê´€ë¦¬ì ëª¨ë‹¬ ì—´ê¸°
        function showAdminModal() {
            // í˜„ì¬ ì„¤ì •ê°’ìœ¼ë¡œ í¼ ì±„ìš°ê¸°
            document.getElementById('solapiApiKey').value = smsSettings.solapiApiKey || '';
            document.getElementById('solapiSecret').value = smsSettings.solapiSecret || '';
            document.getElementById('senderNumber').value = smsSettings.senderNumber || '';
            document.getElementById('kakaoChannelId').value = smsSettings.kakaoChannelId || '';
            
            document.getElementById('templateIssue').value = smsSettings.templates.issue || '';
            document.getElementById('templateReady').value = smsSettings.templates.ready || '';
            document.getElementById('templateCall').value = smsSettings.templates.call || '';
            
            document.getElementById('notificationReady').checked = smsSettings.notifications.ready || false;
            document.getElementById('autoSend').checked = smsSettings.autoSend || false;
            document.getElementById('testMode').checked = smsSettings.testMode || false;
            document.getElementById('saveLog').checked = smsSettings.saveLog !== false;
            
            document.getElementById('adminModal').style.display = 'block';
        }

        // ê´€ë¦¬ì ëª¨ë‹¬ ë‹«ê¸°
        function hideAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            // í¼ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
            const newSettings = {
                solapiApiKey: document.getElementById('solapiApiKey').value.trim(),
                solapiSecret: document.getElementById('solapiSecret').value.trim(),
                senderNumber: document.getElementById('senderNumber').value.trim(),
                kakaoChannelId: document.getElementById('kakaoChannelId').value.trim(),
                
                templates: {
                    issue: document.getElementById('templateIssue').value.trim(),
                    ready: document.getElementById('templateReady').value.trim(),
                    call: document.getElementById('templateCall').value.trim()
                },
                
                messageTemplates: smsSettings.messageTemplates, // ê¸°ë³¸ í…œí”Œë¦¿ ìœ ì§€
                
                notifications: {
                    issue: true, // í•­ìƒ í™œì„±í™”
                    ready: document.getElementById('notificationReady').checked,
                    call: true // í•­ìƒ í™œì„±í™”
                },
                
                autoSend: document.getElementById('autoSend').checked,
                testMode: document.getElementById('testMode').checked,
                saveLog: document.getElementById('saveLog').checked
            };
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (newSettings.autoSend && (!newSettings.solapiApiKey || !newSettings.solapiSecret || !newSettings.senderNumber)) {
                alert('ìë™ ë°œì†¡ì„ í™œì„±í™”í•˜ë ¤ë©´ ì†”ë¼í”¼ API í‚¤, ì‹œí¬ë¦¿ í‚¤, ë°œì‹ ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            // ì„¤ì • ì—…ë°ì´íŠ¸
            smsSettings = { ...smsSettings, ...newSettings };
            
            // Firebaseì— ì €ì¥
            if (window.firebaseDB) {
                const settingsRef = window.firebaseRef(window.firebaseDB, 'kioskSettings');
                window.firebaseSet(settingsRef, smsSettings).then(() => {
                    console.log('âœ… ì†”ë¼í”¼ ì„¤ì • ì €ì¥ ì™„ë£Œ');
                    updateStatusDisplay();
                    hideAdminModal();
                    showMessage('ì†”ë¼í”¼ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }).catch(error => {
                    console.error('âŒ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
                    showMessage('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
            }
        }

        // í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ë°œì†¡ (ê°œì„ ëœ ë²„ì „)
        async function sendTestMessage() {
            const testNumber = document.getElementById('testNumber').value.trim();
            const testResult = document.getElementById('testResult');
            
            if (!testNumber) {
                showTestResult('í…ŒìŠ¤íŠ¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            if (!smsSettings.solapiApiKey || !smsSettings.solapiSecret) {
                showTestResult('ì†”ë¼í”¼ API í‚¤ì™€ ì‹œí¬ë¦¿ í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ë¹„í™œì„±í™”
            const testBtn = document.querySelector('.test-btn');
            testBtn.disabled = true;
            testBtn.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                // 1ë‹¨ê³„: ì†”ë¼í”¼ ì—°ê²° í…ŒìŠ¤íŠ¸
                showTestResult('1ë‹¨ê³„: ì†”ë¼í”¼ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
                
                const connectionTest = await testSolapiConnection();
                
                if (!connectionTest.success) {
                    showTestResult(`ì—°ê²° ì‹¤íŒ¨: ${connectionTest.error}`, 'error');
                    return;
                }
                
                showTestResult('1ë‹¨ê³„: ì†”ë¼í”¼ ì—°ê²° ì„±ê³µ! 2ë‹¨ê³„: ë©”ì‹œì§€ ë°œì†¡ í…ŒìŠ¤íŠ¸ ì¤‘...', 'success');
                
                // 2ë‹¨ê³„: ì‹¤ì œ ë©”ì‹œì§€ ë°œì†¡ í…ŒìŠ¤íŠ¸
                const testData = {
                    number: 'TEST001',
                    course: 'í…ŒìŠ¤íŠ¸ ê³¼ì •',
                    phoneNumber: testNumber,
                    time: new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
                    timestamp: new Date().toISOString(),
                    waitingCount: 3
                };
                
                // ë°œì‹ ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                if (!smsSettings.senderNumber) {
                    showTestResult('ë°œì‹ ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”. (ì†”ë¼í”¼ì—ì„œ ë“±ë¡í•œ ë²ˆí˜¸)', 'error');
                    return;
                }
                
                const result = await sendSolapi(testData, 'issue');
                
                if (result.success) {
                    if (result.testMode) {
                        showTestResult('í…ŒìŠ¤íŠ¸ ëª¨ë“œ - ë©”ì‹œì§€ ìƒì„± ì„±ê³µ!\nì‹¤ì œ ë°œì†¡í•˜ë ¤ë©´ í…ŒìŠ¤íŠ¸ ëª¨ë“œë¥¼ ë„ì„¸ìš”.', 'success');
                    } else {
                        showTestResult('í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ë°œì†¡ ì„±ê³µ!', 'success');
                    }
                    console.log('âœ… ì†”ë¼í”¼ í…ŒìŠ¤íŠ¸ ë°œì†¡ ì„±ê³µ:', result);
                } else {
                    showTestResult(`í…ŒìŠ¤íŠ¸ ë°œì†¡ ì‹¤íŒ¨: ${result.error}`, 'error');
                    if (result.responseData) {
                        console.error('âŒ ì†”ë¼í”¼ ì‘ë‹µ ìƒì„¸:', result.responseData);
                    }
                }
                
            } catch (error) {
                showTestResult(`í…ŒìŠ¤íŠ¸ ë°œì†¡ ì˜¤ë¥˜: ${error.message}`, 'error');
                console.error('âŒ ì†”ë¼í”¼ í…ŒìŠ¤íŠ¸ ë°œì†¡ ì˜¤ë¥˜:', error);
            } finally {
                // í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                testBtn.disabled = false;
                testBtn.textContent = 'í…ŒìŠ¤íŠ¸ ë°œì†¡';
            }
        }
        
        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ (ê°œì„ ëœ ë²„ì „)
        function showTestResult(message, type) {
            const testResult = document.getElementById('testResult');
            testResult.innerHTML = message.replace(/\n/g, '<br>');
            testResult.className = `test-result ${type}`;
            testResult.style.display = 'block';
            
            // successë‚˜ errorê°€ ì•„ë‹Œ ê²½ìš° ìë™ ìˆ¨ê¹€ ì•ˆí•¨
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    testResult.style.display = 'none';
                }, 8000);
            }
        }

        // ì„±ê³µ ë©”ì‹œì§€
        function showSuccess(ticketNumber, courseName) {
            const successEl = document.getElementById('successMsg');
            const textEl = document.getElementById('successText');
            
            let message = `
                <div style="font-size: 2rem; margin-bottom: 10px;">${ticketNumber}</div>
                <div>ğŸ“± ëŒ€ê¸°í‘œ ë°œê¸‰ ì™„ë£Œ!</div>
                <div style="font-size: 1rem; margin-top: 10px;">${courseName}</div>
            `;
            
            if (smsSettings.autoSend) {
                message += `<div style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">ğŸ’¬ ì•Œë¦¼í†¡ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤</div>`;
            }
            
            textEl.innerHTML = message;
            successEl.classList.add('show');
            
            setTimeout(() => {
                successEl.classList.remove('show');
            }, 4000);
        }

        // ì¼ë°˜ ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type = 'info') {
            const messageEl = document.createElement('div');
            messageEl.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                padding: 20px 40px;
                border-radius: 15px;
                font-size: 1.2rem;
                font-weight: 600;
                z-index: 5000;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                ${type === 'success' ? 'background: #d4edda; color: #155724;' : 
                  type === 'error' ? 'background: #f8d7da; color: #721c24;' : 
                  'background: #d1ecf1; color: #0c5460;'}
            `;
            messageEl.textContent = message;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                document.body.removeChild(messageEl);
            }, 3000);
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const adminModal = document.getElementById('adminModal');
            if (event.target === adminModal) {
                hideAdminModal();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }

        console.log('ğŸ« ì•Œë¦¼í†¡ í‚¤ì˜¤ìŠ¤í¬ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
