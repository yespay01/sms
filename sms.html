<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‚¤ì˜¤ìŠ¤í¬ - ì•Œë¦¼í†¡ ëŒ€ê¸°í‘œ (ë°œì†¡ ì„¤ì • í¬í•¨)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            position: relative;
        }
        
        .header h1 {
            color: white;
            font-size: 3rem;
            margin-bottom: 30px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .main-btn {
            background: #00b894;
            color: white;
            border: none;
            padding: 40px 60px;
            border-radius: 20px;
            font-size: 2rem;
            cursor: pointer;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,184,148,0.3);
        }
        
        .main-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0,184,148,0.4);
        }
        
        .main-btn:active {
            background: #00a085;
            transform: translateY(0);
        }

        /* ê´€ë¦¬ì ë²„íŠ¼ */
        .admin-access {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .admin-access:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        /* ì„¤ì • ìƒíƒœ í‘œì‹œ */
        .settings-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            min-width: 200px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .status-item:last-child {
            margin-bottom: 0;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e74c3c;
        }
        
        .status-indicator.active {
            background: #00b894;
        }

        /* íŒì—… */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .popup.show {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .popup-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .popup h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #333;
        }
        
        .phone-display {
            font-size: 2rem;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 20px;
            font-family: monospace;
        }
        
        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .num-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 20px;
            font-size: 1.5rem;
            border-radius: 10px;
            cursor: pointer;
            min-height: 60px;
            transition: all 0.3s ease;
        }
        
        .num-btn:hover {
            background: #2980b9;
            transform: scale(1.05);
        }
        
        .num-btn:active {
            background: #2980b9;
            transform: scale(0.95);
        }
        
        .delete-btn {
            background: #e74c3c;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        .clear-btn {
            background: #f39c12;
            font-size: 1rem;
        }
        
        .clear-btn:hover {
            background: #e67e22;
        }
        
        .close-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .close-btn:hover {
            background: #7f8c8d;
        }
        
        .course-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .course-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 30px 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102,126,234,0.3);
        }
        
        .course-btn:hover {
            background: #5a6fd8;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102,126,234,0.4);
        }
        
        .course-btn:active {
            transform: translateY(0);
        }
        
        .success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #00b894;
            color: white;
            padding: 40px;
            border-radius: 20px;
            font-size: 1.5rem;
            z-index: 2000;
            display: none;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,184,148,0.3);
        }
        
        .success.show {
            display: block;
            animation: successShow 0.5s ease-out;
        }
        
        @keyframes successShow {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        /* ê´€ë¦¬ì ì„¤ì • ëª¨ë‹¬ */
        .admin-modal {
            display: none;
            position: fixed;
            z-index: 3000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        
        .admin-content {
            background-color: white;
            margin: 3% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f1f2f6;
        }
        
        .admin-header h2 {
            color: #667eea;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .close-admin {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-admin:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        .setting-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
        }
        
        .setting-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #2d3436;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .setting-row:last-child {
            margin-bottom: 0;
        }
        
        .setting-label {
            font-weight: 600;
            color: #2d3436;
            flex: 1;
        }
        
        .setting-input {
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            min-width: 200px;
            transition: all 0.3s ease;
        }
        
        .setting-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }
        
        .setting-toggle {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .setting-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #00b894;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .save-btn {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 5px 20px rgba(0,184,148,0.3);
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,184,148,0.4);
        }
        
        .test-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 10px;
        }
        
        .test-btn:hover {
            background: #e67e22;
            transform: scale(1.05);
        }
        
        .test-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        /* ì„¤ì • ìƒíƒœ í‘œì‹œ */
        .config-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .config-status.enabled {
            background: #d4edda;
            color: #155724;
        }
        
        .config-status.disabled {
            background: #f8d7da;
            color: #721c24;
        }

        /* í…ŒìŠ¤íŠ¸ ê²°ê³¼ */
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            display: none;
        }
        
        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f1aeb5;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .admin-content {
                margin: 1% auto;
                padding: 20px;
            }
            
            .setting-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .setting-input {
                width: 100%;
                min-width: auto;
            }
            
            .course-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .main-btn {
                padding: 30px 40px;
                font-size: 1.8rem;
            }
        }
    </style>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCNhcSqZgtSS63QTmjWtiMxgy5g8soOzho",
            authDomain: "alimtalk-waiting-ticket.firebaseapp.com",
            databaseURL: "https://alimtalk-waiting-ticket-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "alimtalk-waiting-ticket",
            storageBucket: "alimtalk-waiting-ticket.firebasestorage.app",
            messagingSenderId: "313045604729",
            appId: "1:313045604729:web:2599fe60cad2b573bc37a8"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseOnValue = onValue;
    </script>
</head>
<body>
    <!-- ê´€ë¦¬ì ë²„íŠ¼ -->
    <button class="admin-access" onclick="showAdminModal()">âš™ï¸ ê´€ë¦¬ì ì„¤ì •</button>

    <!-- ì„¤ì • ìƒíƒœ í‘œì‹œ -->
    <div class="settings-status" id="settingsStatus">
        <div class="status-item">
            <span>ì•Œë¦¼í†¡ ë°œì†¡</span>
            <span class="status-indicator" id="smsStatus"></span>
        </div>
        <div class="status-item">
            <span>Firebase ì—°ê²°</span>
            <span class="status-indicator" id="firebaseStatus"></span>
        </div>
        <div class="status-item">
            <span>ìë™ ë°œì†¡</span>
            <span class="status-indicator" id="autoStatus"></span>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ“± ì•Œë¦¼í†¡ ëŒ€ê¸°í‘œ</h1>
        </div>
        
        <button class="main-btn" onclick="showPhonePopup()">
            ëŒ€ê¸°í‘œ ë°œê¸‰í•˜ê¸°
        </button>
    </div>

    <!-- í•¸ë“œí° ë²ˆí˜¸ íŒì—… -->
    <div class="popup" id="phonePopup">
        <div class="popup-content">
            <h2>í•¸ë“œí° ë²ˆí˜¸ ì…ë ¥</h2>
            <div class="phone-display" id="phoneDisplay">010-</div>
            
            <div class="number-pad">
                <button class="num-btn" onclick="addNum('1')">1</button>
                <button class="num-btn" onclick="addNum('2')">2</button>
                <button class="num-btn" onclick="addNum('3')">3</button>
                <button class="num-btn" onclick="addNum('4')">4</button>
                <button class="num-btn" onclick="addNum('5')">5</button>
                <button class="num-btn" onclick="addNum('6')">6</button>
                <button class="num-btn" onclick="addNum('7')">7</button>
                <button class="num-btn" onclick="addNum('8')">8</button>
                <button class="num-btn" onclick="addNum('9')">9</button>
                <button class="num-btn delete-btn" onclick="deleteNum()">â†</button>
                <button class="num-btn" onclick="addNum('0')">0</button>
                <button class="num-btn clear-btn" onclick="clearNum()">ì „ì²´ì‚­ì œ</button>
            </div>
            
            <button class="close-btn" onclick="closePhonePopup()">ì·¨ì†Œ</button>
        </div>
    </div>

    <!-- ê³¼ì • ì„ íƒ íŒì—… -->
    <div class="popup" id="coursePopup">
        <div class="popup-content">
            <h2>ê³¼ì • ì„ íƒ</h2>
            <div class="phone-display" id="selectedPhone">010-1234-5678</div>
            
            <div class="course-grid" id="courseGrid">
                <!-- ê³¼ì • ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>
            
            <button class="close-btn" onclick="closeCoursePopup()">ëŒì•„ê°€ê¸°</button>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ì„¤ì • ëª¨ë‹¬ -->
    <div id="adminModal" class="admin-modal">
        <div class="admin-content">
            <div class="admin-header">
                <h2>âš™ï¸ ì•Œë¦¼í†¡ ë°œì†¡ ì„¤ì •</h2>
                <button class="close-admin" onclick="hideAdminModal()">Ã—</button>
            </div>
            
            <!-- ì•Œë¦¼í†¡ API ì„¤ì • -->
            <div class="setting-section">
                <div class="setting-title">ğŸ“± ì•Œë¦¼í†¡ API ì„¤ì •</div>
                
                <div class="setting-row">
                    <label class="setting-label">API ì„œë²„ URL</label>
                    <input type="text" class="setting-input" id="apiUrl" placeholder="https://your-api-server.com/send-sms">
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">API í‚¤</label>
                    <input type="password" class="setting-input" id="apiKey" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ë°œì‹ ì ë²ˆí˜¸</label>
                    <input type="text" class="setting-input" id="senderNumber" placeholder="02-1234-5678">
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ì•Œë¦¼í†¡ í…œí”Œë¦¿ ID</label>
                    <input type="text" class="setting-input" id="templateId" placeholder="TEMPLATE_001">
                </div>
            </div>
            
            <!-- ë©”ì‹œì§€ í…œí”Œë¦¿ ì„¤ì • -->
            <div class="setting-section">
                <div class="setting-title">ğŸ’¬ ë©”ì‹œì§€ í…œí”Œë¦¿ ì„¤ì •</div>
                
                <div class="setting-row">
                    <label class="setting-label">ì—…ì²´ëª…</label>
                    <input type="text" class="setting-input" id="businessName" placeholder="â—‹â—‹ ì–´í•™ì›">
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ë©”ì‹œì§€ ë‚´ìš©</label>
                    <textarea class="setting-input" id="messageTemplate" rows="4" placeholder="ì•ˆë…•í•˜ì„¸ìš”. {{ì—…ì²´ëª…}}ì…ë‹ˆë‹¤.&#10;ëŒ€ê¸°ë²ˆí˜¸: {{ë²ˆí˜¸}}&#10;ê³¼ì •: {{ê³¼ì •}}&#10;ë°œê¸‰ì‹œê°„: {{ì‹œê°„}}&#10;&#10;í˜¸ì¶œ ì‹œ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤."></textarea>
                </div>
            </div>
            
            <!-- ë°œì†¡ ì˜µì…˜ -->
            <div class="setting-section">
                <div class="setting-title">âš™ï¸ ë°œì†¡ ì˜µì…˜</div>
                
                <div class="setting-row">
                    <label class="setting-label">ìë™ ë°œì†¡ í™œì„±í™”</label>
                    <label class="setting-toggle">
                        <input type="checkbox" id="autoSend">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">í…ŒìŠ¤íŠ¸ ëª¨ë“œ</label>
                    <label class="setting-toggle">
                        <input type="checkbox" id="testMode">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-row">
                    <label class="setting-label">ë°œì†¡ ë¡œê·¸ ì €ì¥</label>
                    <label class="setting-toggle">
                        <input type="checkbox" id="saveLog">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <!-- í…ŒìŠ¤íŠ¸ ë° ì €ì¥ -->
            <div class="setting-section">
                <div class="setting-title">ğŸ”§ í…ŒìŠ¤íŠ¸ ë° ì €ì¥</div>
                
                <div class="setting-row">
                    <label class="setting-label">í…ŒìŠ¤íŠ¸ ë°œì†¡ (ë³¸ì¸ ë²ˆí˜¸)</label>
                    <div>
                        <input type="text" class="setting-input" id="testNumber" placeholder="01012345678" style="width: 200px;">
                        <button class="test-btn" onclick="sendTestMessage()">í…ŒìŠ¤íŠ¸ ë°œì†¡</button>
                    </div>
                </div>
                
                <div class="test-result" id="testResult"></div>
            </div>
            
            <button class="save-btn" onclick="saveSettings()">ì„¤ì • ì €ì¥</button>
        </div>
    </div>

    <!-- ì„±ê³µ ë©”ì‹œì§€ -->
    <div class="success" id="successMsg">
        <div id="successText">ëŒ€ê¸°í‘œ ë°œê¸‰ ì™„ë£Œ!</div>
    </div>

    <script>
        let phoneNumber = '';
        let currentNumbers = { CH: 0, EN: 0, HSK: 0, TO: 0 };
        let courses = [
            { code: 'CH', name: 'ì¤‘êµ­ì–´ ê³¼ì •' },
            { code: 'EN', name: 'ì˜ì–´ ê³¼ì •' },
            { code: 'HSK', name: 'HSK ì‹œí—˜ë°˜' },
            { code: 'TO', name: 'TOEIC ì§‘ì¤‘ë°˜' }
        ];

        // ì•Œë¦¼í†¡ ì„¤ì • (ê¸°ë³¸ê°’)
        let smsSettings = {
            apiUrl: '',
            apiKey: '',
            senderNumber: '',
            templateId: '',
            businessName: '',
            messageTemplate: 'ì•ˆë…•í•˜ì„¸ìš”. {{ì—…ì²´ëª…}}ì…ë‹ˆë‹¤.\nëŒ€ê¸°ë²ˆí˜¸: {{ë²ˆí˜¸}}\nê³¼ì •: {{ê³¼ì •}}\në°œê¸‰ì‹œê°„: {{ì‹œê°„}}\n\ní˜¸ì¶œ ì‹œ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.',
            autoSend: false,
            testMode: false,
            saveLog: true
        };

        // ì´ˆê¸°í™”
        function initialize() {
            console.log('ğŸ« ì•Œë¦¼í†¡ í‚¤ì˜¤ìŠ¤í¬ ì´ˆê¸°í™” ì‹œì‘');
            
            // Firebaseì—ì„œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            loadSettings();
            
            // í‚¤ì˜¤ìŠ¤í¬ ê¸€ë¡œë²Œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            loadGlobalSettings();
            
            // ê³¼ì • ë²„íŠ¼ ìƒì„±
            renderCourseButtons();
            
            // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
            updateStatusDisplay();
            
            console.log('âœ… ì•Œë¦¼í†¡ í‚¤ì˜¤ìŠ¤í¬ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // Firebaseì—ì„œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSettings() {
            if (!window.firebaseDB) return;
            
            const settingsRef = window.firebaseRef(window.firebaseDB, 'kioskSettings');
            window.firebaseOnValue(settingsRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    smsSettings = { ...smsSettings, ...data };
                    console.log('ğŸ“¥ ì•Œë¦¼í†¡ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ:', smsSettings);
                    updateStatusDisplay();
                }
            });
        }

        // í‚¤ì˜¤ìŠ¤í¬ ê¸€ë¡œë²Œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
        function loadGlobalSettings() {
            if (!window.firebaseDB) return;
            
            const globalRef = window.firebaseRef(window.firebaseDB, 'kioskGlobalSettings');
            window.firebaseOnValue(globalRef, (snapshot) => {
                const data = snapshot.val();
                if (data && data.courses) {
                    courses = data.courses;
                    console.log('ğŸ“š ê³¼ì • ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ:', courses);
                    renderCourseButtons();
                }
            });
        }

        // ê³¼ì • ë²„íŠ¼ ë™ì  ìƒì„±
        function renderCourseButtons() {
            const courseGrid = document.getElementById('courseGrid');
            courseGrid.innerHTML = '';
            
            courses.forEach(course => {
                const button = document.createElement('button');
                button.className = 'course-btn';
                button.textContent = course.name;
                button.onclick = () => selectCourse(course);
                courseGrid.appendChild(button);
            });
        }

        // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateStatusDisplay() {
            const smsStatus = document.getElementById('smsStatus');
            const firebaseStatus = document.getElementById('firebaseStatus');
            const autoStatus = document.getElementById('autoStatus');
            
            // ì•Œë¦¼í†¡ ì„¤ì • ìƒíƒœ
            if (smsSettings.apiUrl && smsSettings.apiKey) {
                smsStatus.classList.add('active');
            } else {
                smsStatus.classList.remove('active');
            }
            
            // Firebase ì—°ê²° ìƒíƒœ
            if (window.firebaseDB) {
                firebaseStatus.classList.add('active');
            } else {
                firebaseStatus.classList.remove('active');
            }
            
            // ìë™ ë°œì†¡ ìƒíƒœ
            if (smsSettings.autoSend) {
                autoStatus.classList.add('active');
            } else {
                autoStatus.classList.remove('active');
            }
        }

        // íŒì—… ì—´ê¸°
        function showPhonePopup() {
            phoneNumber = '';
            updatePhoneDisplay();
            document.getElementById('phonePopup').classList.add('show');
        }

        // íŒì—… ë‹«ê¸°
        function closePhonePopup() {
            document.getElementById('phonePopup').classList.remove('show');
        }

        function closeCoursePopup() {
            document.getElementById('coursePopup').classList.remove('show');
        }

        // ë²ˆí˜¸ ì¶”ê°€
        function addNum(num) {
            console.log('ë²ˆí˜¸ ì¶”ê°€:', num);
            if (phoneNumber.length < 11) {
                phoneNumber += num;
                updatePhoneDisplay();
                
                if (phoneNumber.length === 11) {
                    setTimeout(() => {
                        closePhonePopup();
                        showCoursePopup();
                    }, 300);
                }
            }
        }

        // ë²ˆí˜¸ ì‚­ì œ
        function deleteNum() {
            console.log('ë²ˆí˜¸ ì‚­ì œ');
            if (phoneNumber.length > 0) {
                phoneNumber = phoneNumber.slice(0, -1);
                updatePhoneDisplay();
            }
        }

        // ì „ì²´ ì‚­ì œ
        function clearNum() {
            console.log('ì „ì²´ ì‚­ì œ');
            phoneNumber = '';
            updatePhoneDisplay();
        }

        // í™”ë©´ ì—…ë°ì´íŠ¸
        function updatePhoneDisplay() {
            const display = document.getElementById('phoneDisplay');
            
            if (phoneNumber.length === 0) {
                display.textContent = '010-';
            } else if (phoneNumber.length <= 4) {
                display.textContent = '010-' + phoneNumber;
            } else if (phoneNumber.length <= 8) {
                display.textContent = '010-' + phoneNumber.substring(0, 4) + '-' + phoneNumber.substring(4);
            } else {
                display.textContent = '010-' + phoneNumber.substring(0, 4) + '-' + phoneNumber.substring(4, 8);
            }
        }

        // ê³¼ì • ì„ íƒ íŒì—…
        function showCoursePopup() {
            const formatted = '010-' + phoneNumber.substring(0, 4) + '-' + phoneNumber.substring(4);
            document.getElementById('selectedPhone').textContent = formatted;
            document.getElementById('coursePopup').classList.add('show');
        }

        // ê³¼ì • ì„ íƒ
        function selectCourse(course) {
            console.log('ê³¼ì • ì„ íƒ:', course.name);
            
            // ë²ˆí˜¸ ìƒì„±
            currentNumbers[course.code]++;
            const ticketNumber = course.code + currentNumbers[course.code].toString().padStart(3, '0');
            
            // ëŒ€ê¸°í‘œ ë°ì´í„° ìƒì„±
            const ticketData = {
                number: ticketNumber,
                course: course.name,
                phoneNumber: '010' + phoneNumber,
                time: new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
                timestamp: new Date().toISOString()
            };
            
            // ëŒ€ê¸°ì—´ì— ì¶”ê°€
            addToWaitingQueue(ticketData);
            
            // ì•Œë¦¼í†¡ ë°œì†¡
            if (smsSettings.autoSend) {
                sendSMS(ticketData);
            }
            
            // ì„±ê³µ ë©”ì‹œì§€
            showSuccess(ticketNumber, course.name);
            closeCoursePopup();
        }

        // ëŒ€ê¸°ì—´ì— ì¶”ê°€
        function addToWaitingQueue(ticketData) {
            if (!window.firebaseDB) return;
            
            // ì¹´ìš´í„° ì‹œìŠ¤í…œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const systemRef = window.firebaseRef(window.firebaseDB, 'counterSystem');
            window.firebaseGet(systemRef).then((snapshot) => {
                let systemData = snapshot.val();
                
                if (!systemData) {
                    systemData = {
                        currentCall: { number: '-', counter: 0, course: '-' },
                        waiting: [],
                        counters: Array.from({length: 6}, (_, i) => ({
                            id: i + 1,
                            current: null,
                            course: null,
                            count: 0
                        })),
                        totalToday: 0,
                        counterSettings: {}
                    };
                }
                
                // ëŒ€ê¸°ì—´ì— ì¶”ê°€
                if (!systemData.waiting) systemData.waiting = [];
                systemData.waiting.push(ticketData);
                systemData.totalToday = (systemData.totalToday || 0) + 1;
                
                // Firebaseì— ì €ì¥
                window.firebaseSet(systemRef, systemData);
                
                console.log('âœ… ëŒ€ê¸°ì—´ ì¶”ê°€ ì™„ë£Œ:', ticketData);
            }).catch(error => {
                console.error('âŒ ëŒ€ê¸°ì—´ ì¶”ê°€ ì‹¤íŒ¨:', error);
            });
        }

        // ì•Œë¦¼í†¡ ë°œì†¡
        async function sendSMS(ticketData) {
            if (!smsSettings.apiUrl || !smsSettings.apiKey) {
                console.log('âš ï¸ ì•Œë¦¼í†¡ ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                // ë©”ì‹œì§€ í…œí”Œë¦¿ ì²˜ë¦¬
                const message = smsSettings.messageTemplate
                    .replace(/\{\{ì—…ì²´ëª…\}\}/g, smsSettings.businessName || 'ëŒ€ê¸°í‘œ ì‹œìŠ¤í…œ')
                    .replace(/\{\{ë²ˆí˜¸\}\}/g, ticketData.number)
                    .replace(/\{\{ê³¼ì •\}\}/g, ticketData.course)
                    .replace(/\{\{ì‹œê°„\}\}/g, ticketData.time);
                
                const smsData = {
                    to: ticketData.phoneNumber,
                    from: smsSettings.senderNumber,
                    message: message,
                    templateId: smsSettings.templateId,
                    testMode: smsSettings.testMode
                };
                
                console.log('ğŸ“± ì•Œë¦¼í†¡ ë°œì†¡ ì‹œë„:', smsData);
                
                const response = await fetch(smsSettings.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${smsSettings.apiKey}`
                    },
                    body: JSON.stringify(smsData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    console.log('âœ… ì•Œë¦¼í†¡ ë°œì†¡ ì„±ê³µ:', result);
                    
                    // ë¡œê·¸ ì €ì¥
                    if (smsSettings.saveLog) {
                        saveLog({
                            ...ticketData,
                            smsResult: result,
                            sendTime: new Date().toISOString(),
                            status: 'success'
                        });
                    }
                } else {
                    console.error('âŒ ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨:', result);
                    
                    // ì‹¤íŒ¨ ë¡œê·¸ ì €ì¥
                    if (smsSettings.saveLog) {
                        saveLog({
                            ...ticketData,
                            smsResult: result,
                            sendTime: new Date().toISOString(),
                            status: 'failed'
                        });
                    }
                }
                
            } catch (error) {
                console.error('âŒ ì•Œë¦¼í†¡ ë°œì†¡ ì˜¤ë¥˜:', error);
                
                // ì˜¤ë¥˜ ë¡œê·¸ ì €ì¥
                if (smsSettings.saveLog) {
                    saveLog({
                        ...ticketData,
                        smsResult: { error: error.message },
                        sendTime: new Date().toISOString(),
                        status: 'error'
                    });
                }
            }
        }

        // ë¡œê·¸ ì €ì¥
        function saveLog(logData) {
            if (!window.firebaseDB) return;
            
            const logRef = window.firebaseRef(window.firebaseDB, `smsLogs/${new Date().toISOString().split('T')[0]}`);
            const timestamp = new Date().toISOString();
            
            window.firebaseGet(logRef).then((snapshot) => {
                let logs = snapshot.val() || {};
                logs[timestamp] = logData;
                return window.firebaseSet(logRef, logs);
            }).then(() => {
                console.log('ğŸ“ ë¡œê·¸ ì €ì¥ ì™„ë£Œ');
            }).catch(error => {
                console.error('âŒ ë¡œê·¸ ì €ì¥ ì‹¤íŒ¨:', error);
            });
        }

        // ê´€ë¦¬ì ëª¨ë‹¬ ì—´ê¸°
        function showAdminModal() {
            // í˜„ì¬ ì„¤ì •ê°’ìœ¼ë¡œ í¼ ì±„ìš°ê¸°
            document.getElementById('apiUrl').value = smsSettings.apiUrl || '';
            document.getElementById('apiKey').value = smsSettings.apiKey || '';
            document.getElementById('senderNumber').value = smsSettings.senderNumber || '';
            document.getElementById('templateId').value = smsSettings.templateId || '';
            document.getElementById('businessName').value = smsSettings.businessName || '';
            document.getElementById('messageTemplate').value = smsSettings.messageTemplate || '';
            document.getElementById('autoSend').checked = smsSettings.autoSend || false;
            document.getElementById('testMode').checked = smsSettings.testMode || false;
            document.getElementById('saveLog').checked = smsSettings.saveLog !== false;
            
            document.getElementById('adminModal').style.display = 'block';
        }

        // ê´€ë¦¬ì ëª¨ë‹¬ ë‹«ê¸°
        function hideAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            // í¼ì—ì„œ ê°’ ê°€ì ¸ì˜¤ê¸°
            const newSettings = {
                apiUrl: document.getElementById('apiUrl').value.trim(),
                apiKey: document.getElementById('apiKey').value.trim(),
                senderNumber: document.getElementById('senderNumber').value.trim(),
                templateId: document.getElementById('templateId').value.trim(),
                businessName: document.getElementById('businessName').value.trim(),
                messageTemplate: document.getElementById('messageTemplate').value.trim(),
                autoSend: document.getElementById('autoSend').checked,
                testMode: document.getElementById('testMode').checked,
                saveLog: document.getElementById('saveLog').checked
            };
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (newSettings.autoSend && (!newSettings.apiUrl || !newSettings.apiKey)) {
                alert('ìë™ ë°œì†¡ì„ í™œì„±í™”í•˜ë ¤ë©´ API URLê³¼ API í‚¤ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            // ì„¤ì • ì—…ë°ì´íŠ¸
            smsSettings = { ...smsSettings, ...newSettings };
            
            // Firebaseì— ì €ì¥
            if (window.firebaseDB) {
                const settingsRef = window.firebaseRef(window.firebaseDB, 'kioskSettings');
                window.firebaseSet(settingsRef, smsSettings).then(() => {
                    console.log('âœ… ì„¤ì • ì €ì¥ ì™„ë£Œ');
                    updateStatusDisplay();
                    hideAdminModal();
                    showMessage('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }).catch(error => {
                    console.error('âŒ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
                    showMessage('ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                });
            }
        }

        // í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ë°œì†¡
        async function sendTestMessage() {
            const testNumber = document.getElementById('testNumber').value.trim();
            const testResult = document.getElementById('testResult');
            
            if (!testNumber) {
                showTestResult('í…ŒìŠ¤íŠ¸ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            if (!smsSettings.apiUrl || !smsSettings.apiKey) {
                showTestResult('API URLê³¼ API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            // í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ë¹„í™œì„±í™”
            const testBtn = document.querySelector('.test-btn');
            testBtn.disabled = true;
            testBtn.textContent = 'ë°œì†¡ ì¤‘...';
            
            try {
                const testData = {
                    number: 'TEST001',
                    course: 'í…ŒìŠ¤íŠ¸ ê³¼ì •',
                    phoneNumber: testNumber,
                    time: new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
                    timestamp: new Date().toISOString()
                };
                
                // ë©”ì‹œì§€ í…œí”Œë¦¿ ì²˜ë¦¬
                const message = smsSettings.messageTemplate
                    .replace(/\{\{ì—…ì²´ëª…\}\}/g, smsSettings.businessName || 'ëŒ€ê¸°í‘œ ì‹œìŠ¤í…œ')
                    .replace(/\{\{ë²ˆí˜¸\}\}/g, testData.number)
                    .replace(/\{\{ê³¼ì •\}\}/g, testData.course)
                    .replace(/\{\{ì‹œê°„\}\}/g, testData.time);
                
                const smsData = {
                    to: testData.phoneNumber,
                    from: smsSettings.senderNumber,
                    message: message,
                    templateId: smsSettings.templateId,
                    testMode: true // í…ŒìŠ¤íŠ¸ ëª¨ë“œ ê°•ì œ í™œì„±í™”
                };
                
                const response = await fetch(smsSettings.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${smsSettings.apiKey}`
                    },
                    body: JSON.stringify(smsData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showTestResult('í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    console.log('âœ… í…ŒìŠ¤íŠ¸ ë°œì†¡ ì„±ê³µ:', result);
                } else {
                    showTestResult(`í…ŒìŠ¤íŠ¸ ë°œì†¡ ì‹¤íŒ¨: ${result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                    console.error('âŒ í…ŒìŠ¤íŠ¸ ë°œì†¡ ì‹¤íŒ¨:', result);
                }
                
            } catch (error) {
                showTestResult(`í…ŒìŠ¤íŠ¸ ë°œì†¡ ì˜¤ë¥˜: ${error.message}`, 'error');
                console.error('âŒ í…ŒìŠ¤íŠ¸ ë°œì†¡ ì˜¤ë¥˜:', error);
            } finally {
                // í…ŒìŠ¤íŠ¸ ë²„íŠ¼ ë‹¤ì‹œ í™œì„±í™”
                testBtn.disabled = false;
                testBtn.textContent = 'í…ŒìŠ¤íŠ¸ ë°œì†¡';
            }
        }

        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ
        function showTestResult(message, type) {
            const testResult = document.getElementById('testResult');
            testResult.textContent = message;
            testResult.className = `test-result ${type}`;
            testResult.style.display = 'block';
            
            // 5ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                testResult.style.display = 'none';
            }, 5000);
        }

        // ì„±ê³µ ë©”ì‹œì§€
        function showSuccess(ticketNumber, courseName) {
            const successEl = document.getElementById('successMsg');
            const textEl = document.getElementById('successText');
            
            let message = `
                <div style="font-size: 2rem; margin-bottom: 10px;">${ticketNumber}</div>
                <div>ğŸ“± ëŒ€ê¸°í‘œ ë°œê¸‰ ì™„ë£Œ!</div>
                <div style="font-size: 1rem; margin-top: 10px;">${courseName}</div>
            `;
            
            if (smsSettings.autoSend) {
                message += `<div style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">ğŸ’¬ ì•Œë¦¼í†¡ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤</div>`;
            }
            
            textEl.innerHTML = message;
            successEl.classList.add('show');
            
            setTimeout(() => {
                successEl.classList.remove('show');
            }, 4000);
        }

        // ì¼ë°˜ ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type = 'info') {
            const messageEl = document.createElement('div');
            messageEl.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                padding: 20px 40px;
                border-radius: 15px;
                font-size: 1.2rem;
                font-weight: 600;
                z-index: 5000;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                ${type === 'success' ? 'background: #d4edda; color: #155724;' : 
                  type === 'error' ? 'background: #f8d7da; color: #721c24;' : 
                  'background: #d1ecf1; color: #0c5460;'}
            `;
            messageEl.textContent = message;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                document.body.removeChild(messageEl);
            }, 3000);
        }

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const adminModal = document.getElementById('adminModal');
            if (event.target === adminModal) {
                hideAdminModal();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initialize);
        } else {
            initialize();
        }

        console.log('ğŸ« ì•Œë¦¼í†¡ í‚¤ì˜¤ìŠ¤í¬ ì‹œìŠ¤í…œ ë¡œë“œ ì™„ë£Œ');
    </script>
</body>
</html>
